# 백엔드 아키텍처

## 시스템 아키텍처 개요

이 시스템은 **마이크로서비스 아키텍처** 기반의 멀티 서버 구조로 설계되었습니다. 각 서버는 특정 기능에 특화되어 있으며, FastAPI를 통해 독립적으로 운영됩니다.

```
┌─────────────────────────────────────────────────────────┐
│                    Load Balancer                       │
└─────────────────────┬───────────────────────────────────┘
                      │
    ┌─────────────────┼─────────────────┐
    │                 │                 │
┌───▼────┐    ┌──────▼────┐    ┌───────▼────┐    ┌─────────▼────┐
│Spider  │    │MySQL      │    │Bid         │    │Board         │
│Server  │    │Server     │    │Server      │    │Server        │
│:11301   │    │:11302      │    │:11303       │    │:11307         │
└────────┘    └───────────┘    └────────────┘    └──────────────┘
     │              │                │                   │
     └──────────────┼────────────────┼───────────────────┘
                    │                │
            ┌───────▼────────────────▼─────┐
            │      MySQL Database          │
            │      (Port: 2306)           │
            └─────────────────────────────┘
```

## 서버별 아키텍처

### 1. Spider Server (포트 11301)
**목적**: 웹 스크래핑 전용 서버

**주요 기능**:
- 정부 기관 웹사이트 스크래핑
- Playwright 브라우저 자동화
- lxml HTML/XML 파싱
- 동적 콘텐츠 처리

**핵심 모듈**:
```
spider_list.py          # 메인 스크래핑 로직
spider_detail.py       # 상세 페이지 처리
spider_lxml.py         # lxml 기반 파싱
utils_lxml.py          # XML/HTML 유틸리티
```

**처리 흐름**:
```
API 요청 → 스크래핑 설정 조회 → 브라우저 실행 → 페이지 스크래핑 → 데이터 파싱 → 응답 반환
```

### 2. MySQL Server (포트 11302)
**목적**: 데이터베이스 직접 조작 서버

**주요 기능**:
- 원시 MySQL 쿼리 실행
- 데이터 CRUD 작업
- 대량 데이터 처리
- 데이터베이스 관리

**핵심 모듈**:
```
utils_mysql.py         # 기본 MySQL 래퍼
mysql_bid.py           # 입찰 관련 쿼리
mysql_board.py         # 게시판 관련 쿼리
```

**연결 관리**:
- 커넥션 풀링
- 자동 재연결
- 트랜잭션 관리

### 3. Bid Server (포트 11303)
**목적**: 메인 비즈니스 로직 서버

**주요 기능**:
- 키워드 매칭 및 분류
- 검색 및 필터링
- 외부 API 연동
- 비즈니스 규칙 처리

**핵심 기능**:
```
키워드 분석 → 가중치 계산 → 카테고리 분류 → 우선순위 결정
```

### 4. Board Server (포트 11307)
**목적**: 수동 관리 및 게시판 기능

**주요 기능**:
- 수동 콘텐츠 관리
- 게시판 시스템
- 관리자 인터페이스
- 예외 처리

## 데이터 플로우

### 1. 스크래핑 데이터 플로우
```
정부 웹사이트
    ↓ (Spider Server)
스크래핑된 원시 데이터
    ↓ (MySQL Server)
데이터베이스 저장
    ↓ (Bid Server)
키워드 매칭 및 분류
    ↓
분류된 입찰공고 데이터
```

### 2. 검색 데이터 플로우
```
사용자 검색 요청
    ↓ (Bid Server)
키워드 분석 및 가중치 계산
    ↓ (MySQL Server)
데이터베이스 쿼리 실행
    ↓ (Bid Server)
결과 정렬 및 필터링
    ↓
검색 결과 반환
```

## 기술 스택 아키텍처

### 웹 프레임워크 레이어
```
FastAPI (ASGI)
    ↓
Uvicorn (ASGI Server)
    ↓
Python 3.12
```

### 데이터 처리 레이어
```
Pydantic (데이터 검증)
    ↓
Business Logic
    ↓
Data Access Layer
```

### 스크래핑 기술 스택
```
Playwright (브라우저 자동화)
    ↓
lxml (HTML/XML 파싱)
    ↓
requests (HTTP 클라이언트)
```

### 데이터베이스 레이어
```
MySQL 8.0
    ↓
PyMySQL (드라이버)
    ↓
Connection Pool
```

## 설정 관리 아키텍처

### 환경 설정
```
.env 파일 → 환경변수 → 애플리케이션 설정
```

### 스크래핑 설정
```
settings_list 테이블 → 기관별 설정 → 동적 스크래핑 규칙
```

### 키워드 설정
```
settings_category 테이블 → 키워드 규칙 → 자동 분류 로직
```

## 확장성 고려사항

### 수평 확장
- 각 서버는 독립적으로 스케일 아웃 가능
- 로드 밸런서를 통한 트래픽 분산
- 서버별 리소스 최적화

### 수직 확장
- CPU 집약적: Spider Server (브라우저 실행)
- 메모리 집약적: MySQL Server (대량 데이터 처리)
- I/O 집약적: Bid Server (검색 및 분류)

### 성능 최적화
```
├── 데이터베이스 최적화
│   ├── 인덱스 설계
│   ├── 쿼리 최적화
│   └── 커넥션 풀링
│
├── 애플리케이션 최적화
│   ├── 비동기 처리
│   ├── 캐싱 전략
│   └── 배치 처리
│
└── 인프라 최적화
    ├── 서버 분리
    ├── 리소스 모니터링
    └── 자동 스케일링
```

## 보안 아키텍처

### 네트워크 보안
- 서버 간 내부 통신
- 방화벽 규칙 적용
- SSL/TLS 암호화

### 데이터 보안
- 환경변수를 통한 민감 정보 관리
- 데이터베이스 접근 권한 제어
- 로그 데이터 마스킹

### 애플리케이션 보안
- 입력 데이터 검증
- SQL 인젝션 방지
- CORS 설정 관리

## 모니터링 및 로깅

### 로깅 아키텍처
```
애플리케이션 로그
    ↓
파일 시스템 (/logs/)
    ↓
로그 분석 및 모니터링
```

### 로그 종류
- `server_*.log`: 서버별 운영 로그
- `spider_*.log`: 스크래핑 작업 로그
- `cron.log`: 자동 실행 로그
- `entrypoint.log`: 컨테이너 시작 로그

## 배포 아키텍처

### 컨테이너화
```
Docker Container
    ├── Python 3.12 Runtime
    ├── 애플리케이션 코드
    ├── 의존성 패키지
    └── 설정 파일
```

### 자동화
```
├── 스크래핑 자동화
│   ├── Cron 스케줄러
│   ├── 일일 2회 실행
│   └── 오류 복구 로직
│
└── 배포 자동화
    ├── 컨테이너 빌드
    ├── 서비스 재시작
    └── 헬스 체크
```